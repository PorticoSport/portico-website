---
import Layout from "@/layouts/Layout.astro"
import HeroContainer from "@/components/HeroContainer.astro"
import Breadcrumb from "@/components/Breadcrumb.astro"
import Section from "@/components/Section.astro"
import { getI18N, getCurrentLocale } from "@/i18n"

const { slug } = Astro.props
const { url } = Astro
const i18n = getI18N({ host: url.host })
const currentLocale = getCurrentLocale({ host: url.host })

function convertDate(dateToconvert:string) {
  const options = { year: 'numeric', month: 'long', day: 'numeric' };
  const fecha = new Date(dateToconvert);
  return fecha.toLocaleDateString(i18n.LOCALE_DATE, options as any );
}

const response = await fetch(`https://porticosport.com/wp-json/wp/v2/posts?slug=${slug}&_embed`)
const post = await response.json()
const { title: {rendered}, date, yoast_head_json: {title, description}, content: {rendered: content}, _embedded } = post[0]
const { source_url: image, alt_text: imgAlt } = _embedded["wp:featuredmedia"][0]
const author = _embedded["author"][0].name
const finalTitle = rendered || title
const finalDate = convertDate(date)
---
<Layout title={finalTitle} description={description} currentLocale={currentLocale}>
  <HeroContainer img={image} imgAlt={imgAlt || finalTitle} heading={finalTitle} />
  <main class="pb-24 flex flex-col">
    <Breadcrumb
      crumbs={[
        { label: i18n.ROUTES.HOME.LABEL, href: i18n.ROUTES.HOME.URL },
        { label: i18n.ROUTES.NEWS.LABEL, href: i18n.ROUTES.NEWS.URL },
        { label: finalTitle, href: `${i18n.ROUTES.HOME.URL}/${slug}` },
      ]} />
    <Section>
      <p class="text-gray-500">{i18n.NEWS.POST_PAGE.WRITE} {author} <span class="date">{finalDate}</span></p>
      <article set:html={content}  class="content" />
    </Section>
  </main>
</Layout>

<style>
  .date::before {
    content: ' - ';
  }

</style>
<style is:global>
  .content a {
    @apply text-primary;
    @apply transition-colors;
  }
  
  .content a:hover {
    @apply text-secondary;
  }

  .wp-block-image {
    @apply my-8;
  }
</style>